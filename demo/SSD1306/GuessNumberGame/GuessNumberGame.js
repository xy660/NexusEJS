let SSD1306 = require("/SSD1306_lite.nejs");
let oled = SSD1306.create(5, 4, 2);

oled.setInverseColor(true);
//24x24
let titleFont = {
    "猜": [0, 0, 0, 0, 132, 228, 124, 248, 191, 7, 134, 132, 244, 252, 126, 127, 251, 99, 98, 96, 96, 64, 0, 0, 0, 0, 0, 1, 49, 56, 14, 255, 3, 3, 1, 1, 248, 15, 111, 125, 253, 65, 254, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 3, 7, 0, 0, 0, 0, 0]
    , "数": [0, 0, 0, 0, 0, 112, 120, 176, 216, 248, 191, 90, 78, 244, 16, 204, 162, 30, 0, 0, 0, 0, 0, 0, 0, 0, 0, 12, 238, 39, 55, 255, 217, 236, 63, 54, 233, 72, 72, 120, 57, 57, 63, 96, 224, 192, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0]
    , "字": [0, 0, 0, 224, 124, 4, 4, 198, 198, 103, 39, 191, 247, 121, 25, 13, 15, 14, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3, 0, 96, 240, 112, 56, 63, 31, 31, 46, 252, 28, 24, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 2, 6, 4, 12, 12, 7, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
}
//16x16
let cnfont = {
    "大": [16, 16, 16, 16, 16, 16, 144, 255, 144, 16, 16, 16, 16, 16, 16, 0, 64, 96, 32, 16, 8, 4, 3, 0, 3, 4, 24, 48, 32, 64, 64, 0]
    , "了": [0, 2, 2, 2, 2, 2, 2, 2, 226, 50, 18, 10, 14, 6, 6, 0, 0, 0, 0, 0, 32, 32, 32, 32, 31, 0, 0, 0, 0, 0, 0, 0]
    , "小": [0, 0, 192, 48, 24, 0, 0, 0, 255, 0, 0, 8, 48, 192, 128, 0, 4, 3, 0, 0, 32, 32, 32, 32, 31, 0, 0, 0, 0, 0, 3, 6]
    , "正": [0, 2, 2, 242, 2, 2, 2, 2, 254, 130, 130, 130, 130, 130, 130, 0, 32, 32, 32, 63, 32, 32, 32, 32, 63, 32, 32, 32, 32, 32, 32, 32]
    , "确": [0, 194, 242, 46, 34, 242, 8, 244, 146, 147, 242, 158, 150, 144, 240, 0, 1, 0, 31, 8, 8, 47, 24, 15, 4, 4, 63, 4, 36, 36, 63, 0]
    , "请": [32, 33, 226, 4, 32, 42, 170, 170, 170, 191, 170, 170, 170, 170, 34, 0, 0, 32, 31, 16, 8, 0, 63, 10, 10, 10, 42, 42, 42, 63, 0, 0]
    , "输": [196, 180, 142, 229, 132, 36, 240, 88, 86, 209, 19, 22, 152, 16, 240, 32, 8, 8, 8, 127, 4, 4, 127, 74, 74, 127, 0, 0, 79, 64, 127, 0]
    , "入": [0, 0, 0, 0, 0, 2, 132, 248, 48, 192, 0, 0, 0, 0, 0, 0, 0, 64, 96, 48, 24, 14, 3, 0, 0, 0, 3, 12, 24, 48, 96, 64]
    , "：": [0, 0, 0, 48, 48, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 24, 24, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
};
//10x16
let numberFont = {
    "1": [0, 0, 16, 8, 248, 252, 0, 0, 0, 0, 0, 0, 0, 0, 63, 63, 0, 0, 0, 0]
    , "2": [0, 8, 4, 4, 4, 140, 248, 120, 0, 0, 0, 56, 60, 38, 35, 33, 33, 32, 0, 0]
    , "3": [0, 8, 132, 132, 132, 204, 124, 56, 0, 0, 0, 16, 32, 32, 32, 32, 49, 31, 14, 0]
    , "4": [0, 0, 128, 192, 112, 24, 252, 252, 0, 0, 4, 7, 5, 4, 4, 4, 63, 63, 4, 4]
    , "5": [0, 0, 252, 252, 132, 132, 132, 4, 0, 0, 0, 0, 16, 32, 32, 32, 49, 31, 15, 0]
    , "6": [0, 224, 240, 24, 140, 132, 132, 132, 0, 0, 0, 15, 31, 49, 32, 32, 49, 31, 15, 0]
    , "7": [0, 4, 4, 4, 132, 244, 124, 12, 0, 0, 0, 0, 0, 60, 63, 3, 0, 0, 0, 0]
    , "8": [0, 0, 56, 120, 196, 132, 196, 124, 56, 0, 0, 14, 31, 49, 32, 32, 49, 31, 14, 0]
    , "9": [0, 112, 248, 140, 4, 4, 140, 248, 240, 0, 0, 0, 16, 33, 33, 33, 24, 31, 7, 0]
    , "0": [0, 224, 248, 12, 4, 4, 12, 248, 240, 0, 0, 15, 31, 48, 32, 32, 48, 31, 7, 0]
}


let GameContext = {
    userInput : 0,
    trueAnwser : Math.floor(Math.random() * 11),
}

println("[DEBUG]正确答案：" + GameContext.trueAnwser);

function updateUI() {
    oled.clear();

    oled.drawString(titleFont, 28, 0, 24, 24, "猜数字");

    oled.drawString(cnfont, 0, 48, 16, 16, "请输入：");

    oled.drawString(numberFont, 64, 48, 10, 16, GameContext.userInput + "");

    oled.commit();
}

function popBox(message) {
    let fontSize = 16;
    let x = (128 - (message.length * fontSize + 4)) / 2;
    let y = (64 - fontSize) / 2;
    oled.fillRect(x,y,message.length * fontSize + 4,fontSize,false);
    oled.drawRect(x - 2,y - 2,message.length * fontSize + 4,fontSize + 4);
    oled.drawString(cnfont,x + 2,y,16,16,message);
    oled.commit();
    System.delay(2000);
    updateUI();
}

println("update:" + updateUI);

updateUI();

Gpio.set(12,true); //12作为信号源

//确认键按下前一直扫描用户输入（电平被拉高表示按钮按下）
while (true) {
    while (true) {
        if (Gpio.read(21)) {
            println("确认");
            break;
        } else if (Gpio.read(19)) {
            GameContext.userInput++;
            updateUI();
        }
        System.delay(10);
    }
    if (GameContext.userInput !== GameContext.trueAnwser) {
        println(GameContext);
        println(GameContext.userInput < GameContext.trueAnwser);
        if(GameContext.userInput < GameContext.trueAnwser){
            popBox("小了");
        }else{
            popBox("大了");
        }
        GameContext.userInput = 0;
        updateUI();
        
    } else {
        popBox("正确");
        break;
    }
}

oled.clear();
oled.commit(); //清屏退出
System.delay(1000);

